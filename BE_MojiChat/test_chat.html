<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Chat Moji</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
<h2>Chat Moji Tester</h2>
<div id="status" style="color: red;">ƒêang k·∫øt n·ªëi...</div>

<input type="text" id="roomId" placeholder="Nh·∫≠p Conversation ID v√†o ƒë√¢y">
<button onclick="joinRoom()">V√†o ph√≤ng chat</button>
<br><br>
<input type="text" id="senderId" placeholder="Nh·∫≠p ID ng∆∞·ªùi g·ª≠i (User A)">
<input type="text" id="messageInput" placeholder="N·ªôi dung tin nh·∫Øn...">
<button onclick="sendMessage()">G·ª≠i</button>

<script>
    // K·∫øt n·ªëi ƒë·∫øn Server Python
    const socket = io("http://localhost:8000", {
        transports: ["websocket"] // B·∫Øt bu·ªôc d√πng websocket
    });

    socket.on("connect", () => {
        document.getElementById("status").innerText = "üü¢ ƒê√£ k·∫øt n·ªëi: " + socket.id;
        document.getElementById("status").style.color = "green";
    });

    socket.on("disconnect", () => {
        document.getElementById("status").innerText = "üî¥ M·∫•t k·∫øt n·ªëi";
        document.getElementById("status").style.color = "red";
    });

    // Nh·∫≠n tin nh·∫Øn t·ª´ server
    socket.on("receive_message", (data) => {
        const li = document.createElement("li");
        li.innerText = JSON.stringify(data);
        document.getElementById("messages").appendChild(li);
    });

    // G·ª≠i tin nh·∫Øn
    function sendMessage() {
        const input = document.getElementById("messageInput");
        const text = input.value;
        // G·ª≠i s·ª± ki·ªán 'send_message' l√™n server
        socket.emit("send_message", { content: text, user: "TestUser" });
        input.value = "";
    }

    function joinRoom() {
        const room = document.getElementById("roomId").value;
        socket.emit("join_room", { room_id: room });
    }

    function sendMessage() {
        const room = document.getElementById("roomId").value;
        const sender = document.getElementById("senderId").value;
        const text = document.getElementById("messageInput").value;

        socket.emit("send_message", {
            conversation_id: room,
            sender_id: sender,
            content: text
        });
    }
</script>
</body>
</html>